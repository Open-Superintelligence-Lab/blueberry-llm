â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    EXPERIMENT 10: ROUTING TEMPERATURE                        â•‘
â•‘                     & EXPERT SPECIALIZATION ANALYSIS                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ OVERVIEW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Systematic exploration of routing temperature effects on MoE training:
â€¢ How temperature affects convergence speed and final performance
â€¢ Expert utilization and load balancing dynamics
â€¢ Temperature scheduling strategies (exploration â†’ exploitation)
â€¢ Expert specialization patterns under different routing regimes

ğŸ”¬ RESEARCH QUESTIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. What is the optimal routing temperature for MoE training?
2. Does temperature scheduling improve upon constant temperature?
3. How does temperature affect expert specialization?
4. Can we reduce load balancing loss through temperature tuning?

ğŸ—ï¸  ARCHITECTURE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Model:      MoE Transformer (classic attention)
Experts:    8 experts, top-2 routing
Size:       ~79M total params (~28.4% active)
Dimensions: d_model=384, n_heads=8, n_layers=6, d_ff=1536

âš™ï¸  EXPERIMENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Temperature Ablation (500 steps each):
  â€¢ temp_0.5   - Very sharp routing (strong exploitation)
  â€¢ temp_0.7   - Sharp routing
  â€¢ temp_1.0   - Standard softmax (baseline)
  â€¢ temp_1.5   - Slightly softer routing
  â€¢ temp_2.0   - Softer routing (more exploration)
  â€¢ temp_3.0   - Soft routing (high exploration)
  â€¢ temp_5.0   - Very soft routing
  â€¢ temp_10.0  - Nearly uniform routing

Temperature Schedules (500 steps each):
  â€¢ schedule_linear  - Linear decay from 5.0 â†’ 1.0
  â€¢ schedule_cosine  - Cosine decay from 5.0 â†’ 1.0
  â€¢ schedule_exp     - Exponential decay from 5.0 â†’ 1.0
  â€¢ schedule_step    - Step decay: 5.0â†’2.0â†’1.0

Extended Training:
  â€¢ temp_best_long   - Best temperature, 1000 steps

ğŸ“Š METRICS TRACKED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Performance:
  â€¢ Validation loss, accuracy, perplexity
  â€¢ Training time (wall-clock)

Routing:
  â€¢ Expert utilization distribution
  â€¢ Load balancing loss
  â€¢ Routing entropy (diversity measure)
  â€¢ Expert selection confidence

Specialization:
  â€¢ Expert activation patterns
  â€¢ Gini coefficient (utilization inequality)
  â€¢ Utilization variance

ğŸš€ QUICK START
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# List all experiments
python run_experiment.py --list

# Run quick demo (3 temperatures)
bash quick_demo.sh

# Run full temperature ablation
python run_experiment.py --ablation

# Run temperature schedules
python run_experiment.py --schedules

# Run single temperature
python run_experiment.py --experiment temp_2.0

# Generate visualizations
python plot_results.py --results-dir ./results --output-dir ./analysis
python analyze_specialization.py --results-dir ./results --output-dir ./analysis

ğŸ“ˆ EXPECTED OUTCOMES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Temperature ~1.5-2.0 likely optimal (based on theory)
â€¢ Very low temperature (0.5) â†’ load imbalance
â€¢ Very high temperature (10.0) â†’ insufficient specialization
â€¢ Temperature scheduling should combine exploration + exploitation
â€¢ Clear trade-off between load balancing and specialization

ğŸ¯ KEY CONTRIBUTIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Optimal routing temperature for MoE training
2. Temperature scheduling strategies
3. Expert specialization dynamics under different routing regimes
4. Load balancing effectiveness as function of temperature
5. Comprehensive routing metrics and visualization toolkit

ğŸ“ OUTPUT FILES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Each experiment produces:
  â€¢ results/{exp_name}/metrics.json        - Complete training history
  â€¢ results/{exp_name}/model.pt            - Model checkpoint
  â€¢ results/{exp_name}/logs/               - Training logs

Analysis generates:
  â€¢ analysis/temperature_ablation_comprehensive.png
  â€¢ analysis/routing_dynamics.png
  â€¢ analysis/expert_utilization.png
  â€¢ analysis/expert_utilization_analysis.png
  â€¢ analysis/entropy_analysis.png
  â€¢ analysis/schedule_comparison.png
  â€¢ analysis/summary_report.json
  â€¢ analysis/specialization_report.json

ğŸ”§ CONFIGURATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Optimizer:  Muon (hybrid) with optimal settings from exp9
  â€¢ Muon LR:      0.07
  â€¢ AdamW LR:     0.007
  â€¢ Momentum:     0.9
  â€¢ Weight decay: 0.2

Training:
  â€¢ Steps:        500 (1000 for extended)
  â€¢ Batch size:   24
  â€¢ Grad accum:   4
  â€¢ LR schedule:  Cosine with 5% warmup
  â€¢ Load bal:     0.01

Dataset:    HuggingFaceTB/smollm-corpus (cosmopedia-v2)
  â€¢ Train docs:   1,800
  â€¢ Val docs:     200
  â€¢ Seq length:   512 tokens

ğŸ’¡ KEY INSIGHTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Temperature controls exploration-exploitation trade-off:
  â€¢ Low temp (< 1.0):  Sharp routing, fast specialization, risk of imbalance
  â€¢ Medium temp (1-2): Balanced routing, good for most cases
  â€¢ High temp (> 2):   Exploratory routing, better load balance, slower convergence

Scheduling strategy:
  â€¢ Start high (exploration) to find good expert assignments
  â€¢ Decay to lower values (exploitation) for final refinement
  â€¢ Cosine/exponential schedules likely superior to linear

ğŸ“š REFERENCES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Switch Transformers (Fedus+ 2021) - Load balancing in MoE
â€¢ GShard (Lepikhin+ 2020) - Scaling MoE models
â€¢ Expert Choice Routing (Zhou+ 2022) - Alternative routing
â€¢ Soft MoE (Puigcerver+ 2023) - Soft expert assignments

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Created: November 11, 2025
Branch:  exp10-routing-temperature-analysis
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

